<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Fridge - Smart Meal Planning</title>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link
href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<!-- CSS Files -->
<link rel="stylesheet" href="css/variables.css">
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/components.css">
<link rel="stylesheet" href="css/responsive.css">
<!-- Favicon -->
<link rel="icon" type="image/x-icon" href="assets/favicon.ico">
<style>
/* Calendar Split Layout Styles */
.calendar-split-container {
display: flex;
height: calc(100vh - 120px);
gap: var(--space-6);
padding: var(--space-4);
box-sizing: border-box;
}

/* Left Panel - Meal Details */
.meal-details-panel {
flex: 1;
display: flex;
flex-direction: column;
gap: var(--space-6);
min-width: 0; /* Prevent flex overflow */
}

.meal-details-header {
background: var(--bg-primary);
border-radius: var(--radius-2xl);
padding: var(--space-6);
box-shadow: var(--shadow-lg);
border: 1px solid var(--border-light);
}

.meal-details-header h2 {
margin: 0 0 var(--space-3) 0;
color: var(--text-primary);
font-size: var(--text-2xl);
font-weight: var(--font-semibold);
}

.total-calories {
color: var(--text-secondary);
font-size: var(--text-lg);
font-weight: var(--font-medium);
}

.total-calories span:last-child {
color: var(--primary-color);
font-weight: var(--font-bold);
}

.meal-details-content {
flex: 1;
display: flex;
flex-direction: column;
gap: var(--space-4);
overflow-y: auto;
min-height: 200px;
}

.no-meals-selected {
display: flex;
flex-direction: column;
align-items: center;
justify-content: center;
padding: var(--space-12);
color: var(--text-secondary);
text-align: center;
background: var(--bg-primary);
border-radius: var(--radius-2xl);
border: 1px solid var(--border-light);
}

.empty-meal-icon {
font-size: 4rem;
margin-bottom: var(--space-4);
opacity: 0.5;
}

.meal-card {
background: var(--bg-primary);
border-radius: var(--radius-2xl);
padding: var(--space-6);
box-shadow: var(--shadow-lg);
border: 1px solid var(--border-light);
display: flex;
gap: var(--space-4);
transition: var(--transition-all);
}

.meal-card:hover {
transform: translateY(-2px);
box-shadow: var(--shadow-xl);
}

.meal-image {
width: 80px;
height: 80px;
border-radius: var(--radius-xl);
background: var(--bg-secondary);
display: flex;
align-items: center;
justify-content: center;
font-size: 2rem;
flex-shrink: 0;
overflow: hidden;
}

.meal-image img {
width: 100%;
height: 100%;
object-fit: cover;
}

.meal-info {
flex: 1;
display: flex;
flex-direction: column;
justify-content: center;
min-width: 0;
}

.meal-name {
font-size: var(--text-xl);
font-weight: var(--font-semibold);
color: var(--text-primary);
margin-bottom: var(--space-2);
word-wrap: break-word;
}

.meal-nutrition {
display: flex;
flex-direction: column;
gap: var(--space-1);
}

.nutrition-item {
color: var(--text-secondary);
font-size: var(--text-sm);
}

/* Top Meals Section */
.top-meals-section {
background: var(--bg-primary);
border-radius: var(--radius-2xl);
padding: var(--space-6);
box-shadow: var(--shadow-lg);
border: 1px solid var(--border-light);
}

.top-meals-section h3 {
margin: 0 0 var(--space-4) 0;
color: var(--text-primary);
font-size: var(--text-xl);
font-weight: var(--font-semibold);
}

.top-meals-grid {
display: flex;
gap: var(--space-4);
overflow-x: auto;
padding-bottom: var(--space-2);
}

.top-meal-item {
flex-shrink: 0;
display: flex;
flex-direction: column;
align-items: center;
padding: var(--space-3);
background: var(--bg-secondary);
border-radius: var(--radius-lg);
min-width: 120px;
transition: var(--transition-all);
position: relative;
}

.top-meal-item:hover {
background: var(--bg-tertiary);
transform: translateY(-2px);
}

.top-meal-image {
width: 60px;
height: 60px;
border-radius: var(--radius-lg);
background: var(--bg-tertiary);
display: flex;
align-items: center;
justify-content: center;
font-size: 1.5rem;
margin-bottom: var(--space-2);
position: relative;
overflow: hidden;
}

.top-meal-image img {
width: 100%;
height: 100%;
object-fit: cover;
}

.meal-rank {
position: absolute;
top: -8px;
right: -8px;
background: var(--primary-color);
color: white;
border-radius: 50%;
width: 24px;
height: 24px;
display: flex;
align-items: center;
justify-content: center;
font-size: var(--text-xs);
font-weight: var(--font-bold);
border: 2px solid white;
}

.top-meal-name {
font-size: var(--text-sm);
font-weight: var(--font-medium);
color: var(--text-primary);
text-align: center;
margin-bottom: var(--space-1);
word-wrap: break-word;
}

.meal-count {
font-size: var(--text-xs);
color: var(--text-secondary);
}

/* Right Panel - Calendar */
.calendar-panel {
flex: 1;
background: var(--primary-color);
border-radius: var(--radius-2xl);
padding: var(--space-6);
color: white;
min-width: 0;
}

.calendar-header-new {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: var(--space-6);
}

.calendar-header-new h2 {
margin: 0;
color: white;
font-size: var(--text-2xl);
font-weight: var(--font-semibold);
}

.calendar-nav-btn {
background: rgba(255, 255, 255, 0.2);
border: none;
border-radius: var(--radius-lg);
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-size: var(--text-lg);
cursor: pointer;
transition: var(--transition-all);
}

.calendar-nav-btn:hover {
background: rgba(255, 255, 255, 0.3);
transform: scale(1.1);
}

.calendar-weekdays {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: var(--space-2);
margin-bottom: var(--space-4);
}

.weekday {
text-align: center;
color: rgba(255, 255, 255, 0.8);
font-size: var(--text-sm);
font-weight: var(--font-medium);
padding: var(--space-2);
}

.calendar-dates-grid {
display: grid;
grid-template-columns: repeat(7, 1fr);
gap: var(--space-2);
}

.calendar-date {
aspect-ratio: 1;
display: flex;
align-items: center;
justify-content: center;
border-radius: var(--radius-lg);
font-weight: var(--font-medium);
cursor: pointer;
transition: var(--transition-all);
position: relative;
min-height: 50px;
}

.calendar-date:hover {
background: rgba(255, 255, 255, 0.1);
}

.calendar-date.other-month {
color: rgba(255, 255, 255, 0.3);
}

.calendar-date.selected {
background: white;
color: var(--primary-color);
font-weight: var(--font-bold);
}

.calendar-date.today {
background: rgba(255, 255, 255, 0.2);
border: 2px solid white;
}

.calendar-date.has-meals::after {
content: '';
position: absolute;
bottom: 4px;
left: 50%;
transform: translateX(-50%);
width: 6px;
height: 6px;
background: rgba(255, 255, 255, 0.8);
border-radius: 50%;
}

.calendar-date.selected.has-meals::after {
background: var(--primary-color);
}

/* Mobile Responsiveness */
@media (max-width: 968px) {
.calendar-split-container {
flex-direction: column;
height: auto;
min-height: calc(100vh - 120px);
}

.meal-details-panel {
order: 2;
}

.calendar-panel {
order: 1;
min-height: 400px;
}

.top-meals-grid {
justify-content: center;
}
}

@media (max-width: 640px) {
.calendar-split-container {
padding: var(--space-2);
gap: var(--space-4);
}

.meal-details-header,
.top-meals-section,
.calendar-panel {
padding: var(--space-4);
}

.calendar-dates-grid {
gap: var(--space-1);
}

.calendar-date {
min-height: 40px;
font-size: var(--text-sm);
}

.meal-card {
flex-direction: column;
text-align: center;
}

.meal-image {
align-self: center;
}

.meal-nutrition {
align-items: center;
}
}

/* Modal styles */
.modal {
position: fixed;
top: 0;
left: 0;
width: 100%;
height: 100%;
background: rgba(0, 0, 0, 0.5);
display: flex;
align-items: center;
justify-content: center;
z-index: 1000;
opacity: 0;
transition: opacity 0.3s ease;
}

.modal.active {
opacity: 1;
}

.modal-content {
background: var(--bg-primary);
border-radius: var(--radius-xl);
padding: var(--space-6);
max-width: 600px;
width: 90%;
max-height: 80vh;
overflow-y: auto;
transform: scale(0.9);
transition: transform 0.3s ease;
box-shadow: var(--shadow-lg);
}

.modal.active .modal-content {
transform: scale(1);
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: var(--space-5);
padding-bottom: var(--space-3);
border-bottom: 1px solid var(--border-light);
}

.modal-title {
color: var(--text-primary);
font-size: var(--text-xl);
font-weight: var(--font-semibold);
}

.modal-close {
background: none;
border: none;
font-size: 1.5rem;
cursor: pointer;
color: var(--text-secondary);
padding: var(--space-2);
border-radius: var(--radius-md);
transition: all 0.3s ease;
width: 40px;
height: 40px;
display: flex;
align-items: center;
justify-content: center;
}

.modal-close:hover {
background: var(--bg-secondary);
color: var(--text-primary);
}

/* Toast notifications */
.toast {
position: fixed;
top: 20px;
right: 20px;
background: var(--success-color);
color: white;
padding: var(--space-4) var(--space-5);
border-radius: var(--radius-lg);
box-shadow: var(--shadow-lg);
transform: translateX(100%);
transition: transform 0.3s ease;
z-index: 1100;
max-width: 300px;
}

.toast.show {
transform: translateX(0);
}

.toast.error {
background: var(--error-color);
}

.toast.warning {
background: var(--warning-color);
}

@media (max-width: 480px) {
.toast {
left: 20px;
right: 20px;
top: 20px;
transform: translateY(-100%);
max-width: none;
}

.toast.show {
transform: translateY(0);
}
}

/* Ensure proper responsive layout */
@media (max-width: 1200px) {
.dashboard-grid {
grid-template-columns: 1fr 1fr;
}
}

@media (max-width: 768px) {
.dashboard-grid {
grid-template-columns: 1fr;
}
}
</style>
</head>

<body>
<div class="container">
<!-- Header -->
<div class="header">
<h1>Smart Fridge</h1>
<p>Smart meal planning with your ingredients</p>
</div>

<!-- Smart Fridge Layout with Persistent Navigation -->
<div class="smart-fridge-layout">
<!-- Sidebar Navigation -->
<nav class="sidebar">
<div class="logo">
<img src="assets/images/Smart Fridge.png" alt="Smart Fridge Logo" class="logo-image">
</div>
<ul class="nav-menu">
<li class="nav-item active">
<a href="#" onclick="showSection('dashboard')">
<span class="nav-icon">
<img src="assets/images/Dashboard.png" alt="Dashboard" class="nav-icon-image">
</span>
<span class="nav-text">Dashboard</span>
</a>
</li>
<li class="nav-item">
<a href="#" onclick="showSection('inventory')">
<span class="nav-icon">
<img src="assets/images/Inventory.png" alt="Inventory" class="nav-icon-image">
</span>
<span class="nav-text">Inventory</span>
</a>
</li>
<li class="nav-item">
<a href="#" onclick="showSection('recipes')">
<span class="nav-icon">
<img src="assets/images/Recipe.png" alt="Recipes" class="nav-icon-image">
</span>
<span class="nav-text">Recipes</span>
</a>
</li>
<li class="nav-item">
<a href="#" onclick="showSection('calendar')">
<span class="nav-icon">
<img src="assets/images/Calendar.png" alt="Calendar" class="nav-icon-image">
</span>
<span class="nav-text">Calendar</span>
</a>
</li>
<li class="nav-item">
<a href="#" onclick="showSection('goals')">
<span class="nav-icon">
<img src="assets/images/Goals.png" alt="Goals" class="nav-icon-image">
</span>
<span class="nav-text">Goals</span>
</a>
</li>
</ul>
</nav>

<!-- Main Content Area for all sections -->
<main class="main-content">
<!-- Dashboard Section -->
<div id="dashboard" class="content-section active">
<!-- Top Row -->
<div class="dashboard-top-row">
<!-- Today's Progress Card -->
<div class="progress-card">
<h2>Today's Progress</h2>
<div class="progress-content">
<div class="calorie-display">
<div class="calorie-circle">
<svg width="120" height="120" viewBox="0 0 120 120">
<defs>
<linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" style="stop-color:#4ECDC4"/>
<stop offset="100%" style="stop-color:#44A08D"/>
</linearGradient>
</defs>
<circle cx="60" cy="60" r="50" fill="none" stroke="#e0e0e0" stroke-width="8"/>
<circle class="circle-progress" cx="60" cy="60" r="50" fill="none"
stroke="url(#gradient)" stroke-width="8" stroke-linecap="round"/>
</svg>
<div class="circle-text">
<span class="number">0</span>
<span class="label">of 2000 cal</span>
</div>
</div>
<div class="consumed-label">Consumed</div>
</div>
<div class="macros-display">
<!-- Macros will be populated by JavaScript -->
</div>
</div>
<!-- Meals List -->
<div class="meals-list" id="meals-breakdown">
<!-- Meals will be populated by JavaScript -->
</div>
</div>
<!-- Things to Make Card -->
<div class="suggestions-card">
<h2>Things to Make</h2>
<div class="recipe-suggestions" id="recipe-suggestions">
<!-- Recipes will be populated by JavaScript -->
</div>
</div>
</div>
<!-- Shopping List Card -->
<div class="shopping-list-card">
<h2>Shopping List</h2>
<div class="shopping-grid" id="auto-grocery-grid">
<!-- Shopping items will be populated by JavaScript -->
</div>
</div>
</div>

<!-- Inventory Section -->
<div id="inventory" class="content-section">
<div class="dashboard-grid">
<div class="card">
<h3>Add Ingredient</h3>
<form id="ingredientForm">
<div class="form-group">
<label for="ingredientName">Ingredient Name</label>
<input type="text" id="ingredientName" placeholder="e.g., Chicken Breast" required>
</div>
<div class="form-group">
<label for="ingredientQuantity">Quantity</label>
<input type="number" id="ingredientQuantity" placeholder="e.g., 2" step="0.1" min="0" required>
</div>
<div class="form-group">
<label for="ingredientUnit">Unit</label>
<select id="ingredientUnit" required>
<option value="">Select unit...</option>
<option value="grams">Grams</option>
<option value="kg">Kilograms</option>
<option value="pieces">Pieces</option>
<option value="cups">Cups</option>
<option value="tablespoons">Tablespoons</option>
<option value="teaspoons">Teaspoons</option>
<option value="ounces">Ounces</option>
<option value="pounds">Pounds</option>
<option value="milliliters">Milliliters</option>
<option value="liters">Liters</option>
</select>
</div>
<button type="submit" class="btn btn-primary">Add to Inventory</button>
</form>
</div>
<div class="card">
<h3>Current Inventory</h3>
<div class="ingredient-list" id="inventoryList">
<!-- This will be populated by the Inventory component -->
</div>
</div>
</div>
</div>

<!-- Recipes Section -->
<div id="recipes" class="content-section">
<div class="card" style="margin-bottom: var(--space-8);">
<h3>Recipe Filters</h3>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--space-4);">
<div class="form-group">
<label>Max Calories</label>
<input type="number" placeholder="e.g., 500" id="maxCalories">
</div>
<div class="form-group">
<label>Min Protein (g)</label>
<input type="number" placeholder="e.g., 20" id="minProtein">
</div>
<div class="form-group">
<label>Cuisine Type</label>
<select id="cuisineType">
<option value="">All Cuisines</option>
<option value="asian">Asian</option>
<option value="italian">Italian</option>
<option value="mexican">Mexican</option>
<option value="american">American</option>
<option value="mediterranean">Mediterranean</option>
</select>
</div>
<div class="form-group">
<button class="btn btn-primary" onclick="filterRecipes()" style="margin-top: 24px;">Find Recipes</button>
</div>
</div>
</div>
<div class="recipe-grid">
<!-- Recipes will be populated by JavaScript -->
</div>
</div>

<!-- Calendar Section -->
<div id="calendar" class="content-section">
<div class="calendar-split-container">
<!-- Left Side: Meal Details -->
<div class="meal-details-panel">
<div class="meal-details-header">
<h2 id="selected-date-title">Meals on this day</h2>
<div class="total-calories">
<span>Total Calories: </span>
<span id="daily-total-calories">0</span>
</div>
</div>

<div class="meal-details-content" id="meal-details-content">
<!-- Meals will be populated by JavaScript -->
<div class="no-meals-selected">
<div class="empty-meal-icon">🍽️</div>
<p>Select a date to view meals</p>
</div>
</div>

<!-- Top Meals Section -->
<div class="top-meals-section">
<h3>Top Meals This Month</h3>
<div class="top-meals-grid" id="top-meals-grid">
<!-- Top meals will be populated by JavaScript -->
</div>
</div>
</div>

<!-- Right Side: Calendar Grid -->
<div class="calendar-panel">
<div class="calendar-header-new">
<button class="calendar-nav-btn" id="prev-month" onclick="navigateMonth(-1)">
<span>‹</span>
</button>
<h2 id="calendar-month-display">Loading...</h2>
<button class="calendar-nav-btn" id="next-month" onclick="navigateMonth(1)">
<span>›</span>
</button>
</div>

<div class="calendar-weekdays">
<div class="weekday">Mon</div>
<div class="weekday">Tue</div>
<div class="weekday">Wed</div>
<div class="weekday">Thu</div>
<div class="weekday">Fri</div>
<div class="weekday">Sat</div>
<div class="weekday">Sun</div>
</div>

<div class="calendar-dates-grid" id="calendar-dates-grid">
<!-- Calendar dates will be populated by JavaScript -->
</div>
</div>
</div>
</div>

<!-- Goals Section -->
<div id="goals" class="content-section">
<div class="dashboard-grid">
<div class="card">
<h3>Daily Nutrition Goals</h3>
<form>
<div class="form-group">
<label>Daily Calorie Target</label>
<input type="number" placeholder="e.g., 2000">
</div>
<div class="form-group">
<label>Protein Goal (g)</label>
<input type="number" placeholder="e.g., 150">
</div>
<div class="form-group">
<label>Carbs Goal (g)</label>
<input type="number" placeholder="e.g., 250">
</div>
<div class="form-group">
<label>Fat Goal (g)</label>
<input type="number" placeholder="e.g., 65">
</div>
<button type="submit" class="btn btn-primary">Update Goals</button>
</form>
</div>
<div class="card">
<h3>Weekly Progress</h3>
<div class="stats-grid">
<!-- Stats will be populated by JavaScript -->
</div>
</div>
</div>
</div>
</main>
</div>
</div>

<!-- JavaScript Files - Load in correct order -->
<!-- Data files first -->
<script src="js/data/recipes.js"></script>
<script src="js/data/nutrition.js"></script>
<script src="js/data/ingredients.js"></script>
<!-- Utility files -->
<script src="js/utils/helpers.js"></script>
<script src="js/utils/storage.js"></script>
<script src="js/utils/nutrition.js"></script>
<!-- Component files -->
<script src="js/components/inventory.js"></script>
<script src="js/components/dashboard.js"></script>
<script src="js/components/recipes.js"></script>
<script src="js/components/calendar.js"></script>
<script src="js/components/goals.js"></script>
<!-- Main application file last -->
<script src="js/main.js"></script>

<script>
// Calendar functionality for the new design
let currentCalendarDate = new Date();
let selectedDate = null;

// Month navigation
function navigateMonth(direction) {
currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
renderCalendarGrid();
updateCalendarHeader();
}

// Update calendar header
function updateCalendarHeader() {
const monthNames = ["January", "February", "March", "April", "May", "June",
"July", "August", "September", "October", "November", "December"];
const monthDisplay = document.getElementById('calendar-month-display');
if (monthDisplay) {
monthDisplay.textContent = `${monthNames[currentCalendarDate.getMonth()]} ${currentCalendarDate.getFullYear()}`;
}
}

// Render calendar grid
function renderCalendarGrid() {
const grid = document.getElementById('calendar-dates-grid');
if (!grid) return;

const year = currentCalendarDate.getFullYear();
const month = currentCalendarDate.getMonth();
const today = new Date();
const firstDay = new Date(year, month, 1);
const lastDay = new Date(year, month + 1, 0);
const startDate = new Date(firstDay);
startDate.setDate(startDate.getDate() - (firstDay.getDay() || 7) + 1); // Start from Monday

grid.innerHTML = '';

// Generate 42 days (6 weeks)
for (let i = 0; i < 42; i++) {
const date = new Date(startDate);
date.setDate(startDate.getDate() + i);

const dateElement = document.createElement('div');
dateElement.className = 'calendar-date';
dateElement.textContent = date.getDate();
dateElement.dataset.date = date.toISOString().split('T')[0];

// Add classes
if (date.getMonth() !== month) {
dateElement.classList.add('other-month');
}
if (date.toDateString() === today.toDateString()) {
dateElement.classList.add('today');
}
if (selectedDate && date.toDateString() === selectedDate.toDateString()) {
dateElement.classList.add('selected');
}

// Check if date has meals
if (hasMealsOnDate(date)) {
dateElement.classList.add('has-meals');
}

// Add click event
dateElement.addEventListener('click', () => selectDate(date));

grid.appendChild(dateElement);
}
}

// Select a date
function selectDate(date) {
selectedDate = new Date(date);
renderCalendarGrid();
displayMealsForDate(date);
updateSelectedDateTitle(date);
}

// Check if date has meals
function hasMealsOnDate(date) {
const dateKey = date.toISOString().split('T')[0];
if (window.calendar && window.calendar.meals) {
return window.calendar.meals[dateKey] && window.calendar.meals[dateKey].length > 0;
}
return false;
}

// Display meals for selected date
function displayMealsForDate(date) {
const dateKey = date.toISOString().split('T')[0];
const content = document.getElementById('meal-details-content');
const totalCaloriesSpan = document.getElementById('daily-total-calories');

if (!content) return;

let meals = [];
let totalCalories = 0;

// Get meals from calendar component
if (window.calendar && window.calendar.meals && window.calendar.meals[dateKey]) {
meals = window.calendar.meals[dateKey];
totalCalories = meals.reduce((sum, meal) => sum + (meal.calories || 0), 0);
}

// Update total calories
if (totalCaloriesSpan) {
totalCaloriesSpan.textContent = totalCalories;
}

// Render meals
if (meals.length === 0) {
content.innerHTML = `
<div class="no-meals-selected">
<div class="empty-meal-icon">🍽️</div>
<p>No meals logged for this day</p>
<button class="btn btn-primary" onclick="addMealForDate('${dateKey}')">Add Meal</button>
</div>
`;
} else {
content.innerHTML = meals.map(meal => `
<div class="meal-card">
<div class="meal-image">
${meal.emoji || '🍽️'}
</div>
<div class="meal-info">
<div class="meal-name">${meal.name}</div>
<div class="meal-nutrition">
<div class="nutrition-item">${meal.calories || 0} cal</div>
<div class="nutrition-item">${meal.protein || 0}g Protein</div>
<div class="nutrition-item">${meal.carbs || 0}g Carbs</div>
<div class="nutrition-item">${meal.fat || 0}g Fat</div>
</div>
</div>
</div>
`).join('');
}
}

// Update selected date title
function updateSelectedDateTitle(date) {
const title = document.getElementById('selected-date-title');
if (title) {
const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
const isToday = date.toDateString() === new Date().toDateString();
title.textContent = isToday ? 'Meals for Today' : `Meals on ${date.toLocaleDateString('en-US', options)}`;
}
}

// Add meal for specific date
function addMealForDate(dateKey) {
if (window.calendar && typeof window.calendar.showMealPlanningModal === 'function') {
window.calendar.showMealPlanningModal(dateKey);
} else {
showToast('Calendar component not available', 'warning');
}
}

// Render top meals
function renderTopMeals() {
const grid = document.getElementById('top-meals-grid');
if (!grid) return;

const mealFrequency = {};
if (window.calendar && window.calendar.meals) {
Object.values(window.calendar.meals).forEach(dayMeals => {
dayMeals.forEach(meal => {
const key = meal.name.toLowerCase();
if (!mealFrequency[key]) {
mealFrequency[key] = { 
name: meal.name, 
count: 0, 
emoji: meal.emoji || '🍽️' 
};
}
mealFrequency[key].count++;
});
});
}

// Sort and get top 3
const topMeals = Object.values(mealFrequency)
.sort((a, b) => b.count - a.count)
.slice(0, 3);

if (topMeals.length === 0) {
grid.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No meals logged this month</p>';
return;
}

grid.innerHTML = topMeals.map((meal, index) => `
<div class="top-meal-item">
<div class="top-meal-image">
${meal.emoji}
<div class="meal-rank">${index + 1}</div>
</div>
<div class="top-meal-name">${meal.name}</div>
<div class="meal-count">${meal.count} times</div>
</div>
`).join('');
}

// Initialize calendar
document.addEventListener('DOMContentLoaded', function() {
setTimeout(() => {
updateCalendarHeader();
renderCalendarGrid();
renderTopMeals();

// Select today by default
selectDate(new Date());

// Listen for calendar updates
window.addEventListener('calendar-updated', () => {
renderCalendarGrid();
renderTopMeals();
if (selectedDate) {
displayMealsForDate(selectedDate);
}
});
}, 1000);
});

// Global toast function (fallback if not available from main.js)
if (typeof showToast === 'undefined') {
function showToast(message, type = 'success') {
// Remove existing toast
const existingToast = document.querySelector('.toast.show');
if (existingToast) {
existingToast.remove();
}

// Create new toast
const toast = document.createElement('div');
toast.className = `toast ${type}`;
toast.innerHTML = `
<div class="toast-content">
<span class="toast-message">${message}</span>
<button class="toast-close" onclick="this.closest('.toast').remove()">&times;</button>
</div>
`;

// Add to page
document.body.appendChild(toast);

// Show toast
setTimeout(() => toast.classList.add('show'), 10);

// Auto-hide after 3 seconds
setTimeout(() => {
if (toast.parentNode) {
toast.classList.remove('show');
setTimeout(() => toast.remove(), 300);
}
}, 3000);
}
}

// Navigation function (fallback if not available from main.js)
if (typeof showSection === 'undefined') {
function showSection(sectionId) {
// Hide all sections
const sections = document.querySelectorAll('.content-section');
sections.forEach(section => section.classList.remove('active'));

// Show selected section
const targetSection = document.getElementById(sectionId);
if (targetSection) {
targetSection.classList.add('active');
}

// Update active tab in sidebar
const sidebarTabs = document.querySelectorAll('.nav-item');
sidebarTabs.forEach(tab => tab.classList.remove('active'));

// Find and activate the correct sidebar tab
const activeTab = document.querySelector(`.nav-item a[onclick*="${sectionId}"]`)?.parentElement;
if (activeTab) {
activeTab.classList.add('active');
}
}
}

// Recipe filtering function (fallback if not available from main.js)
if (typeof filterRecipes === 'undefined') {
function filterRecipes() {
if (window.recipes && typeof window.recipes.applyFilters === 'function') {
window.recipes.applyFilters();
} else {
console.log('Recipe filters applied');
showToast('Recipe filters applied!', 'success');
}
}
}

// Close modals when clicking outside
document.addEventListener('click', function(e) {
if (e.target.classList.contains('modal')) {
e.target.remove();
}
});

// Close modals with Escape key
document.addEventListener('keydown', function(e) {
if (e.key === 'Escape') {
const modal = document.querySelector('.modal.active');
if (modal) {
modal.remove();
}
}
});
</script>
</body>
</html>